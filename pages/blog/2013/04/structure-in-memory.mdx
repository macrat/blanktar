---
title: メモリの中身と実行ファイル
pubtime: 2013-04-13T00:57+0900
amp: hybrid
tags: [実行ファイル, メモリ]
description: exeファイルなんかの実行ファイルの中身の構造や、メモリ上での展開のされ方について調べてみました。
---

結局のところ。結局のところ、だ。
**実行ファイル**、とは、なんぞや。
てゆか、よく言われる**ヒープ**とか**スタック**とか、どこにあるんや。
あと、exeファイルに**リソースを埋め込む**ってどこに埋め込んだんや。

気になったので、調べたり妄想してみたりしました。正確かどうかはわかりませんが。

上から順番に、ファイルで言うなら先頭の方、メモリで言うならアドレスの少ない方から昇順に参ります。


# ヘッダー
これは、ファイルにだけあるもの。

UNIX系なら**ELFヘッダ**ってのがあって、先頭の方にascii文字でELFって書いてあるらしい。

windowsだとなんか**PEヘッダ**とか**NEヘッダ**とか色々あってよく分からない。きもちわるい。
メモ帳で開くと`This program cannot bt run is DOS mode`ってのがあるので、見分けるのは簡単。

動作するアーキテクチャとか、サイズとかもろもろが入ってるみたい。
つまりはメタデータっすね。


# コード部
プログラムの本体。機械言語でごりごり命令が書いてあるところ。**テキスト領域**、なんて呼び方もあるみたい。

ファイルならヘッダの後ろに書いてあって、メモリに読み込まれるのはここから先みたい。
先端からCPUが読みだして実行していく。


# データ部
ファイルだろうとメモリだろうと、とりあえずコード部の次にあるやつ。**静的領域**なんて呼び名も。

プログラムが使う文字列とか、画像とか、そういうのを埋め込むところ。
**リソースを埋め込む**のはここっぽいね。

試しにバイナリエディタでnotepad.exeを開いてみたら、一番後ろにはXMLがベタって埋め込んでありました。なんてこった。


# ヒープ
いよいよヒープだ。**スタック**でもあり、**データ領域**とも呼ぶようらしい。

ファイルにはなくて、メモリにだけある。ま、作業用の領域だしね。
こいつを頭（アドレスが小さい方）から読むとヒープ領域になって、尻尾（アドレスが大きい方）から読むとスタック領域になる。
・・・うん、意味わからん。

どうやら領域を逆向きに読むことで共有しているようで。
なので配列の添字を無闇にでかくしてヒープを溢れると、スタック領域に触れてしまうらしい。
逆に、スタックオーバーフローってのはヒープ領域に届いてしまったってことみたいね。

---

参考：
- [アプリケーションとメモリの関係 - 徳島大学大学院ソシオテクノサイエンス研究部](http://www.me.tokushima-u.ac.jp/~miw/wadai/IP3/Tips/App&amp;memory.html)
- [メモリの4領域](http://brain.cc.kogakuin.ac.jp/~kanamaru/lecture/MP/final/part06/node8.html)
