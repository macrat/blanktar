pythonのdoctestの使い方とか
2013-05-23 21:59
keywords: python doctest 標準ライブラリ

pythonの標準ライブラリってほんとなんでもあるよね。<br>
というわけで、今回はテストモジュールである<strong>doctest</strong>をご紹介。<br>
<br>
<b>pydoc</b>ってモジュールがあるじゃないっすか。<br>
あれを派生させた感じのモジュールがdoctest。<br>
pydocと同じ形式のコメントに対話形式のサンプルコードを書く。<br>
すると、そいつをチェックして予想通りの結果が得られるかを確認してくれるのね。<br>
<br>
<pre class="code"><code>''' ここに普通にコメント書いたり
&gt;&gt;&gt; print '対話形式で使い方を書いたり'
対話形式で使い方を書いたり

またコメントを書いたり
&gt;&gt;&gt; print 1 + 1
2

&gt;&gt;&gt; print """複数行で
... 書いたり"""
複数行で
書いたり
'''

def Add(a, b):
	''' ここにも同じようにコメントを書いたり

	&gt;&gt;&gt; Add(1, 2)
	3
	&gt;&gt;&gt; print Add('対話形式で', '書いたり')
	対話形式で書いたり
	'''

	return a + b
</code></pre>
こんな感じで書きます。<br>
<br>
使う時は<br>
<pre class="code"><code>python -m doctest ファイル名</code></pre>
とするか、ソースの最後に<br>
<pre class="code"><code>if __name__ == '__main__':
	import doctest
	doctest.testmod()
</code></pre>
を入れるようにしてください。<br>
モジュールとして作ってるなら、これ入れっぱなしでもいいかもね。<br>
<br>
何事もなければ、何も表示されずに終了します。<br>
詳細を見たい時は<br>
<pre class="code"><code>python -m doctest -v ファイル名</code></pre>
で起動すればおっけー。<br>
<br>
例外が送出されることを確認したい時は<br>
<pre class="code"><code>'''
&gt;&gt;&gt; a
Traceback (most recent call last):
	...
NameError: name 'a' is not defined
'''</code></pre>
みたいにすればいいようです。若干めんどいね。<br>
<br>
例外周りがちょっとめんどいにせよ、書いたドキュメントでテストしてくれるのは嬉しいよね。<br>
こういうのをばんばん駆使して効率的に開発できるようになりたいものです。<br>
<br>
参考：<a href="http://docs.python.jp/2/library/doctest.html" target="_blank">doctest -  Python 2.7ja1 documentation</a><br>
