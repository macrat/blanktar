pythonのソースをweb越しにimportしてみる
2013-05-17 13:51
keywords: python import

普通さ、ライブラリはローカルに置くよね。<br>
javascriptなんかはweb上に置いてあることもあるけれど、pythonはローカル。<br>
いやあえて、pythonでもweb上のモジュールを自由にimport出来たら面白いんじゃないか？　とか思った。<br>
という訳で、試してみた。<br>
<br>
<pre class="code"><code>import urllib2
import tempfile
import os

def ImportFromWeb(url):
	# 一時ファイルを用意
	out, name = tempfile.mkstemp(suffix='.py', dir='.')
	out = os.fdopen(out, 'w')

	# URLを開いて、一時ファイルに書き込む
	source = urllib2.urlopen(url)
	out.write(source.read())

	# URL/ファイルを閉じる
	source.close()
	out.close()

	# 一時ファイルをimportする
	imp = __import__(os.path.basename(name)[:-3])

	# 一時ファイルを削除
	#  ついでに.pycファイルも削除
	os.remove(name)
	if os.path.isfile(name[:-3] + '.pyc'):
		os.remove(name[:-3] + '.pyc')

	# importしたオブジェクトを返却
	return imp
</code></pre>
こんな感じ。<br>
<br>
<pre class="code"><code>test = ImportFromWeb('http://example.com/python/source.py')
test.run()
</code></pre>
みたいに使えます。<br>
<br>
一度importしちゃえばソースは消しても問題ないみたいね。<br>
まあ、動作は保証しかねますが。<br>
<br>
あと、これを乱用するとサーバーの管理者に迷惑です。<br>
頻繁に使う場合は、サーバー管理者に確認をとってください。一応ね。<br>
