pythonでhtmlの文字参照をなんとかする。
2013-05-04 03:19
keywords: python html 文字参照

htmlの文字参照ってやつ。めんどいよね。<br>
面倒さのあまりlt、gt、nbsp、あとampあたりだけreplace掛けて良しとしちゃってたりしたんだけどさ。<br>
標準ライブラリのリファレンス見てたら、<a href="http://docs.python.jp/2/library/htmllib.html#module-htmlentitydefs" target="_blank">htmlentitydefs</a>なんて使えそうなものがある。<br>
という訳で使ってみた。<br>
あんま短いコードにならなかった。<br>
がっかり。<br>
<pre class="code"><code>import htmlentitydefs    # python3.xならhtml.entities
import re

def unescape(string):
	for x in re.findall('&amp;[a-zA-Z]+?;', string):
		try:
			rep = htmlentitydefs.name2codepoint[x[1:-1]]
		except KeyError:
			pass
		else:
			rep = unichr(rep)    # python3.xなら普通にchr(rep)でおっけー。
			string = string.replace(x, rep)
	return string


print unescape('test&amp;nbsp;string')
print unescape('&amp;lt;tag in &amp;lt;tag&amp;gt;&amp;gt;')
print unescape('dummy&amp;amp;tag;')
</code></pre>
<br>
もっと短く書く方法あったら教えてくらはい。<br>
<br>
あ、そうそう。<br>
nbspの結果がなんか不思議なことになるので注意。<br>
ノーブレークスペースってやつで、普通のスペースとは違うみたいね。詳しくは<a href="http://ja.wikipedia.org/wiki/%E3%83%8E%E3%83%BC%E3%83%96%E3%83%AC%E3%83%BC%E3%82%AF%E3%82%B9%E3%83%9A%E3%83%BC%E3%82%B9" target="_blank">wikipedia</a>でもどうぞ。<br>
これになっちゃうと困る場合は、個別にreplaceでもしてください。<br>
<code><b>string = string.replace('&amp;nbsp;', ' ')</b></code>みたいな感じで済むから、まあそんな労力にはならんでしょ。<br>
