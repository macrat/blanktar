---
title: vimでバイナリファイルをいじる
pubtime: 2015-03-01T17:17:00+09:00
amp: hybrid
tags: [Vim, バイナリ, xxd]
description: vimとxxdコマンドを組み合わせて、バイナリファイルを読んだり編集したりする方法の解説です。
---

バイナリファイルをいじることなんて滅多にないですが、まあそれでも時々はそんな機会が来るものです。
滅多に来ない機会のためにエディタ入れとくのも嫌だし、かと言っていちいちダウンロードしてくるのも・・・そんなあなたに。vimがあるじゃない。

カレントディレクトリにある**binary.bin**とか言うファイルを編集するとしましょう。
``` shell
$ vim -b binary.bin
```
こんな感じで開く。

このままだと見れたもんじゃないので、
``` vim
:%! xxd
```
`xxd`コマンドでフィルタを掛けます。

すると以下のような形式に変換してくれます。
```
0000000: 7f45 4c46 0201 0100 0000 0000 0000 0000  .ELF............
0000010: 0200 3e00 0100 0000 c047 4000 0000 0000  ..>......G@.....
0000020: 4000 0000 0000 0000 b0a6 0100 0000 0000  @...............
0000030: 0000 0000 4000 3800 0a00 4000 1a00 1900  ....@.8...@.....
0000040: 0600 0000 0500 0000 4000 0000 0000 0000  ........@.......
```
16進数表記にしてアドレスをつけて、しかもasciiも見れるのでとてもいい感じ。

適当に編集したら、
``` vim
:%! xxd -r
:w
```
とやってバイナリに戻して保存します。
続けて編集したいならもう一回xxdすればおっけー。

・・・と、まあこれだけでもいいのだけれどね。
何度も保存したり読み込んだりすると割と面倒くさい。ググったら自動でxxdしたりxxd -rしたりしてくれるやつが出てきました。素敵。
そのままだと問題があったのでちょっと調整して、こんな感じ。
**.vimrc**に丸コピーで動くはずです。
``` vim
augroup BinaryXXD
  autocmd!
  autocmd BufReadPost * if &binary | silent %!xxd -g 1
  autocmd BufReadPost * set ft=xxd | endif
  autocmd BufWritePre * if &binary | %!xxd -r
  autocmd BufWritePre * endif
  autocmd BufWritePost * if &binary | silent %!xxd -g 1
  autocmd BufWritePost * set nomod | endif
augroup END
```
あんまりよく分かってないけど、まあきっと大丈夫でしょう。動いてるし。

バイナリ表示を無効にしたかったら
``` vim
:autocmd! BinaryXXD
```
としてから開き直せば良いようです。
``` vim
:set nobin
```
でも良い気がするけれど、これだとバイナリモードも無効になっちゃうから・・・まあ、使い分け？

いやぁ、便利だねぇ。

参考：[vimでバイナリを表示し、値を変更したい - rderaログ](http://d.hatena.ne.jp/rdera/20081022/1224682665)
