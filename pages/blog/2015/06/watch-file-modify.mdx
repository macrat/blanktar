---
title: Linuxのinotify-toolsでファイルやディレクトリの変更を監視する
pubtime: 2015-06-29T00:25+0900
modtime: 2015-07-01T00:00+0900
amp: hybrid
tags: [inotify, inotify-tools, Linux, 監視]
description: Linuxカーネルが持つファイルシステムの変更検知システムである"inotify"という機能をコマンドラインで扱うためのツール「inotify-tools」の使い方の紹介です。
---

<PS date="2015-07-01" level={1}>

随分前に書いた<a href="/blog/2013/03/python-inotify">pythonからinotifyを利用する記事</a>もあります。よろしければ。

</PS>

ファイルが変更されるタイミングを知りたい時とか、アクセスするタイミングを知りたい時とか、ありますよね。・・・あんまり無いか。
そんな時に活躍するのがLinuxカーネルに組み込まれてるinotifyって機能。
基本は適当な言語からライブラリとして呼び出すようなのですが、面倒なのでコマンドラインから。

`inotify-tools`ってパッケージがあります。適当にパッケージマネージャでインストール。
んでもって、
``` shell
	$ inotifywait -m file.txt
```
とかやると**file.txt**の変更を監視してくれます。
ファイル名の代わりにディレクトリを指定すれば、そのディレクトリの中にあるものを監視してくれます。

再帰的に監視したい場合は`-r`オプションを付ける。
``` shell
$ inotifywait -mr file.txt
```
こんな。

``` shell
$ inotifywait -mc file.txt
```
とかにするとCSV形式で出力します。**監視対象,変更の種類,ファイル名**の順、っぽい。

出力を見ているとアクセスの種類が表示されているのですが、こいつでフィルタリングすることも出来ます。
``` shell
$ inotifywait -me open,close file.txt
```
こうするとファイルを開いた/閉じた時だけ表示。
イベントの名前はヘルプを見れば色々載ってます。accessとかmodifyとかopen/closeとかその他いっぱい。

`--format`オプションを使うと出力のフォーマットを指定したりできます。
細かいことはmanページでどうぞ。

ちなみに、ずっと付けている`-m`オプションを付けないと、一つ目のイベントが発生した時点でコマンドが終了してしまいます。

この記事を書きながらずっとvimのスワップファイルの挙動を見ているのだけれど、これ結構おもしろい。
一回保存するにも何度も保存したり移動したりをやってるのね。
